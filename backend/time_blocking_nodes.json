{
    "newNodes": [
        {
            "parameters": {
                "httpMethod": "GET",
                "path": "appointments/available-hours",
                "responseMode": "responseNode",
                "options": {}
            },
            "name": "Webhook Available Hours",
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 1,
            "position": [
                200,
                2500
            ],
            "webhookId": "available-hours-webhook",
            "id": "webhook-available-hours"
        },
        {
            "parameters": {
                "functionCode": "const WORK_START_HOUR = 9;   // 9:00 AM\nconst WORK_END_HOUR = 17;    // 5:00 PM  \nconst INTERVAL_MINUTES = 60; // 1 hour blocks\n\n// Get date from query parameter\nconst requestedDate = items[0].json.query.date;\n\nif (!requestedDate) {\n  return [{\n    json: {\n      success: false,\n      message: 'Missing date parameter'\n    }\n  }];\n}\n\n// Generate all possible time slots\nconst allHours = [];\nfor (let hour = WORK_START_HOUR; hour <= WORK_END_HOUR; hour++) {\n  const hourStr = hour.toString().padStart(2, '0');\n  allHours.push(`${hourStr}:00`);\n}\n\n// Pass data to next node\nreturn [{\n  json: {\n    requestedDate,\n    allHours\n  }\n}];"
            },
            "name": "Generate Time Slots",
            "type": "n8n-nodes-base.function",
            "typeVersion": 1,
            "position": [
                450,
                2500
            ],
            "id": "generate-time-slots"
        },
        {
            "parameters": {
                "functionCode": "const staticData = getWorkflowStaticData('global');\nconst allAppointments = staticData.appointments || [];\n\n// Get requested date from previous node\nconst requestedDate = $('Generate Time Slots').first().json.requestedDate;\nconst allHours = $('Generate Time Slots').first().json.allHours;\n\n// Filter appointments for this specific date (exclude cancelled)\nconst occupiedHours = allAppointments\n  .filter(a => a.dateStr === requestedDate && a.status !== 'CANCELADA')\n  .map(a => a.time);\n\n// Calculate available hours\nconst availableHours = allHours.filter(hour => !occupiedHours.includes(hour));\n\nreturn [{\n  json: {\n    success: true,\n    date: requestedDate,\n    availableHours: availableHours,\n    occupiedHours: occupiedHours,\n    totalSlots: allHours.length,\n    availableSlots: availableHours.length\n  }\n}];"
            },
            "name": "Calculate Available Hours",
            "type": "n8n-nodes-base.function",
            "typeVersion": 1,
            "position": [
                700,
                2500
            ],
            "id": "calculate-available-hours"
        },
        {
            "parameters": {
                "options": {}
            },
            "name": "Respond Available Hours",
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1,
            "position": [
                950,
                2500
            ],
            "id": "respond-available-hours"
        }
    ],
    "newConnections": {
        "Webhook Available Hours": {
            "main": [
                [
                    {
                        "node": "Generate Time Slots",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Generate Time Slots": {
            "main": [
                [
                    {
                        "node": "Calculate Available Hours",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Calculate Available Hours": {
            "main": [
                [
                    {
                        "node": "Respond Available Hours",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        }
    }
}